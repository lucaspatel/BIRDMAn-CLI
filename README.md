# BIRDMAn - CLI
This is a framework and accompanying simple command line interfance for running [BIRDMAn](https://www.biorxiv.org/content/10.1101/2023.01.30.526328v1) on a SLURM server. 

[BIRDMAn](https://github.com/biocore/BIRDMAn) is a framework for performing differential abundance analyses of microbiome data. BIRDMAn is implemented as a Python interface to the Stan probabilistic programming language, making it very flexible for a variety of microbiome study designs. While BIRDMAn is a powerful tool, it can be challenging to use directly due its large compute overhead. We provide a command line interface that abstracts and parallelizes much of BIRDMAn's core functionality, while also implementing additional visualization logic to more easily interpret results generated by BIRDMAn.

## Getting Started

### Prerequisites
First, install BIRDMAn and its associated dependencies as described [here](https://birdman.readthedocs.io/en/stable/?badge=stable). For convenience, we've provided a [conda](https://docs.conda.io/en/latest/) environment file which can be found after git cloning the repo:
```bash
conda env create -f birdman_env.yml -n birdman
conda activate birdman
```

Or, if using [mamba](https://mamba.readthedocs.io/en/latest/):
```bash
mamba env create -f birdman_env.yml -n birdman
mamba activate birdman
```

This command line interface assumes a pre-configured [SLURM](https://slurm.schedmd.com/documentation.html) environment.

### Installing
Next, simply clone this repository:
```bash
git clone https://github.com/lucaspatel/BIRDMAn-CLI.git
```

Then, move into the repository and install:
```bash
cd BIRDMAn-CLI
pip install -e .
```

## Usage
This CLI consists of three main functions: `run`, `summarize`, and `plot`. Each step must be run sequentially. Below are examples of how to use each:

### Run
The `run` command ingests a [BIOM](https://biom-format.org) table, a metadata, a [Patsy-style](https://patsy.readthedocs.io/en/latest/formulas.html) formula, and an output directory. This command will execute BIRDMAn's main modeling logic, distributed across several jobs via submission to a SLURM cluster. This is accomplished by writing a script file to `<OUT_PATH>/logs` and submitting it. Depending on the size of the input BIOM table, this step may take a long time to complete.
```bash
birdman-cli run -i <BIOM_PATH> -o <OUT_PATH> -m <METADATA_PATH> -f <FORMULA>
```

### Summarize
The `summarize` command parses the results from a previous `run` command and aggeregates the results into a singular tab-separated file.
```bash
birdman-cli summarize -i <IN_PATH> -f <FORMULA>
```

### Plot
The `plot` command generates figures by parsing and annotating the results from the previous `summarize` command. The figures are barplots that depict the modeled log-ratios with error estimates.
```bash
birdman-cli plot -i <IN_PATH> -v <VARIABLES> -t <TAXONOMY>
```

## Testing
This CLI also contains a test suite on the main interface and its utility functions which may be run directly:
```bash
pytest tests/
```

## Improvements
- [ ] Write more tests
- [ ] Improve single-directory workflow
- [ ] Finish autocompletion
- [ ] Configure setuptools
- [ ] Automate tests via GitHub Actions
- [ ] Standardize parameters 
- [ ] Add LICENSE.md

## Built With
* [Click](https://click.palletsprojects.com/en/8.1.x/)

## Contributing
Please read [CONTRIBUTING.md]() for details on our code of conduct, and the process for submitting pull requests to us.

## Authors
* **Gibraan Rahman** - *BIRDMAn implementation* - [gibsramen](https://github.com/gibsramen)
* **Lucas Patel** - *Command line interface implementation* - [lucaspatel](https://github.com/lucaspatel)
* **Sherlyn Wang** - *Command line interface implementation* - [sherlyn99](https://github.com/sherlyn99)

See also the list of [BIRDMAn contributors](https://github.com/biocore/BIRDMAn/graphs/contributors) who participated in its development.

## License
This project is licensed under the BSD-3 License - see the [LICENSE.md](LICENSE.md) file for details

## Acknowledgments
* This codebase is initially derived from Hazel Dilmore's [MARS_Birdman](https://github.com/ahdilmore/MARS_Birdman) repository.
